--[[
    trhdanqexternal - MOBILE OPTIMIZED (Delta)
    Siêu đơn giản, không lỗi, đủ chức năng
]]

local LP = game.Players.LocalPlayer
local Mouse = LP:GetMouse()
local RS = game:GetService("RunService")
local UIS = game:GetService("UserInputService")
local Lighting = game:GetService("Lighting")

-- Variables
local speed = 16
local jump = 50
local flySpeed = 50
local speedOn = false
local jumpOn = false
local flyOn = false
local noclipOn = false
local espOn = false
local lastAFK = tick()

local espObjects = {}

-- GUI
local gui = Instance.new("ScreenGui")
gui.Name = "trhdanqexternal"
gui.Parent = game.CoreGui
gui.ResetOnSpawn = false

-- Button
local btn = Instance.new("TextButton", gui)
btn.Size = UDim2.new(0, 100, 0, 40)
btn.Position = UDim2.new(0, 10, 0, 50)
btn.Text = "Menu"
btn.BackgroundColor3 = Color3.fromRGB(0, 150, 255)
btn.TextColor3 = Color3.new(1, 1, 1)
btn.Font = Enum.Font.GothamBold
btn.TextSize = 12
btn.Draggable = true

-- Window
local window = Instance.new("Frame", gui)
window.Size = UDim2.new(0, 400, 0, 600)
window.Position = UDim2.new(0.5, -200, 0.5, -300)
window.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
window.Visible = false
window.Draggable = true

-- Title
local title = Instance.new("TextLabel", window)
title.Size = UDim2.new(1, 0, 0, 35)
title.BackgroundColor3 = Color3.fromRGB(0, 120, 200)
title.Text = "trhdanqexternal"
title.TextColor3 = Color3.new(1, 1, 1)
title.Font = Enum.Font.GothamBold
title.TextSize = 13

-- Close
local close = Instance.new("TextButton", title)
close.Size = UDim2.new(0, 35, 1, 0)
close.Position = UDim2.new(1, -35, 0, 0)
close.BackgroundColor3 = Color3.fromRGB(200, 50, 50)
close.Text = "X"
close.Font = Enum.Font.GothamBold
close.TextSize = 16

close.MouseButton1Click:Connect(function()
    window.Visible = false
end)

-- Content
local content = Instance.new("ScrollingFrame", window)
content.Size = UDim2.new(1, 0, 1, -35)
content.Position = UDim2.new(0, 0, 0, 35)
content.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
content.CanvasSize = UDim2.new(0, 0, 0, 900)

btn.MouseButton1Click:Connect(function()
    window.Visible = not window.Visible
end)

-- Y Position
local y = 10

-- Add Controls
local function addLabel(text)
    local label = Instance.new("TextLabel", content)
    label.Size = UDim2.new(1, -10, 0, 20)
    label.Position = UDim2.new(0, 5, 0, y)
    label.BackgroundTransparency = 1
    label.Text = text
    label.TextColor3 = Color3.fromRGB(0, 180, 255)
    label.Font = Enum.Font.GothamBold
    label.TextSize = 11
    label.TextXAlignment = Enum.TextXAlignment.Left
    y = y + 25
end

local function addSlider(name, min, max, default, callback)
    local lbl = Instance.new("TextLabel", content)
    lbl.Size = UDim2.new(0.6, 0, 0, 20)
    lbl.Position = UDim2.new(0, 5, 0, y)
    lbl.BackgroundTransparency = 1
    lbl.Text = name .. ": " .. default
    lbl.TextColor3 = Color3.new(1, 1, 1)
    lbl.Font = Enum.Font.Gotham
    lbl.TextSize = 10
    lbl.TextXAlignment = Enum.TextXAlignment.Left

    local box = Instance.new("TextBox", content)
    box.Size = UDim2.new(0.35, 0, 0, 20)
    box.Position = UDim2.new(0.65, 0, 0, y)
    box.Text = tostring(default)
    box.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
    box.TextColor3 = Color3.new(1, 1, 1)
    box.Font = Enum.Font.Gotham
    box.TextSize = 9

    box.FocusLost:Connect(function()
        local val = tonumber(box.Text) or default
        val = math.max(min, math.min(max, val))
        lbl.Text = name .. ": " .. val
        callback(val)
    end)

    y = y + 25
end

local function addButton(name, callback)
    local btn = Instance.new("TextButton", content)
    btn.Size = UDim2.new(1, -10, 0, 30)
    btn.Position = UDim2.new(0, 5, 0, y)
    btn.Text = name
    btn.BackgroundColor3 = Color3.fromRGB(60, 100, 180)
    btn.TextColor3 = Color3.new(1, 1, 1)
    btn.Font = Enum.Font.GothamBold
    btn.TextSize = 11

    btn.MouseButton1Click:Connect(callback)
    y = y + 35
end

-- UI
addLabel("Walk Speed")
addSlider("Speed", 16, 200, 16, function(v) speed = v end)
addButton("Walk Speed: OFF", function()
    speedOn = not speedOn
end)

addLabel("Jump")
addSlider("Jump Pwr", 50, 200, 50, function(v) jump = v end)
addButton("Inf Jump: OFF", function()
    jumpOn = not jumpOn
end)

addLabel("Fly")
addButton("Fly: OFF", function()
    flyOn = not flyOn
end)
addSlider("Fly Spd", 10, 150, 50, function(v) flySpeed = v end)

addLabel("Noclip")
addButton("Noclip: OFF", function()
    noclipOn = not noclipOn
end)

addLabel("Visuals")
addButton("ESP: OFF", function()
    espOn = not espOn
end)

addLabel("Other")
addButton("Reset", function()
    speedOn = false
    jumpOn = false
    flyOn = false
    noclipOn = false
    espOn = false
end)

-- Systems

-- Walk Speed
RS.Heartbeat:Connect(function()
    if speedOn and LP.Character and LP.Character:FindFirstChild("Humanoid") then
        LP.Character.Humanoid.WalkSpeed = speed
    end
end)

-- Jump (Fixed)
local jumpCooldown = 0
UIS.InputBegan:Connect(function(input, gp)
    if gp then return end
    if input.KeyCode == Enum.KeyCode.Space and jumpOn then
        if LP.Character and LP.Character:FindFirstChild("Humanoid") and tick() - jumpCooldown > 0.1 then
            LP.Character.Humanoid:ChangeState(Enum.HumanoidStateType.Jumping)
            jumpCooldown = tick()
        end
    end
end)

-- Fly
RS.RenderStepped:Connect(function()
    if flyOn and LP.Character and LP.Character:FindFirstChild("HumanoidRootPart") then
        local root = LP.Character.HumanoidRootPart
        local cam = workspace.CurrentCamera
        local moveDir = Vector3.new(0, 0, 0)

        if UIS:IsKeyDown(Enum.KeyCode.W) then moveDir = moveDir + cam.CFrame.LookVector end
        if UIS:IsKeyDown(Enum.KeyCode.S) then moveDir = moveDir - cam.CFrame.LookVector end
        if UIS:IsKeyDown(Enum.KeyCode.A) then moveDir = moveDir - cam.CFrame.RightVector end
        if UIS:IsKeyDown(Enum.KeyCode.D) then moveDir = moveDir + cam.CFrame.RightVector end
        if UIS:IsKeyDown(Enum.KeyCode.Space) then moveDir = moveDir + Vector3.new(0, 1, 0) end

        if moveDir.Magnitude > 0 then moveDir = moveDir.Unit end
        root.Velocity = moveDir * flySpeed
    end
end)

-- Noclip
RS.Stepped:Connect(function()
    if noclipOn and LP.Character then
        for _, part in pairs(LP.Character:GetDescendants()) do
            if part:IsA("BasePart") then
                part.CanCollide = false
            end
        end
    end
end)

-- ESP
RS.Heartbeat:Connect(function()
    if espOn then
        for _, player in pairs(game.Players:GetPlayers()) do
            if player ~= LP and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
                if not espObjects[player] then
                    local box = Instance.new("BoxHandleAdornment")
                    box.Adornee = player.Character.HumanoidRootPart
                    box.Size = Vector3.new(2, 5, 2)
                    box.Color3 = Color3.fromRGB(255, 0, 0)
                    box.Transparency = 0.3
                    box.Parent = player.Character.HumanoidRootPart
                    espObjects[player] = box
                end
            end
        end
    else
        for _, obj in pairs(espObjects) do
            pcall(function() obj:Destroy() end)
        end
        espObjects = {}
    end
end)

print("✓ trhdanqexternal loaded!")
